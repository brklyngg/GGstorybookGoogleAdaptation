<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Magic Storybook Maker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Fredoka for titles, Patrick Hand for story text -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Patrick+Hand&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        /* Storybook Ratio (approx 8x10 or square-ish, sticking to 2:3 for consistency with code but softer feel) */
        --page-height: min(85vh, 750px);
        --page-width: calc(var(--page-height) * 0.75); /* Slightly wider for storybook feel */
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background-color: #fdf6e3; /* Solarized light warm base */
        background-image: 
          radial-gradient(#e0d6c2 15%, transparent 16%),
          radial-gradient(#e0d6c2 15%, transparent 16%);
        background-size: 40px 40px;
        background-position: 0 0, 20px 20px;
        z-index: -1;
        pointer-events: none;
      }

      body {
        min-height: 100vh;
        font-family: 'Fredoka', sans-serif;
        margin: 0;
      }
      
      @media (min-width: 769px) {
        body { overflow-x: hidden; }
      }

      .font-title { font-family: 'Fredoka', sans-serif; }
      .font-story { font-family: 'Patrick Hand', cursive; }

      /* --- 3D Book Mechanics --- */
      .comic-scene {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        perspective: 3000px;
        min-width: 100vw;
      }

      .book {
        position: relative;
        width: var(--page-width);
        height: var(--page-height);
        transform-style: preserve-3d;
        transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      
      .book.opened {
          transform: translateX(25%); 
      }
      @media (min-width: 1000px) {
          .book.opened { transform: translateX(calc(var(--page-width) / 2)); }
      }

      .paper {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform-origin: left center;
        transform-style: preserve-3d;
        transition: transform 0.9s cubic-bezier(0.645, 0.045, 0.355, 1.000);
        cursor: pointer;
        border-radius: 4px 12px 12px 4px; /* Soft book corners */
      }

      .paper.flipped {
        transform: rotateY(-180deg);
      }

      .front, .back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        overflow: hidden;
        background-color: #fff;
        transform-style: preserve-3d;
        border-radius: 4px 12px 12px 4px;
      }

      .front {
         padding-left: 0px; 
         box-shadow: inset 10px 0 20px -10px rgba(0,0,0,0.1);
      }
      
      .back {
        transform: rotateY(180deg);
        border-radius: 12px 4px 4px 12px;
        box-shadow: inset -10px 0 20px -10px rgba(0,0,0,0.1);
      }

      /* Gentle paper texture */
      .front::after, .back::after {
          content: "";
          position: absolute;
          inset: 0;
          background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
          pointer-events: none;
          z-index: 10;
          opacity: 0.5;
      }

      .panel-container {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #fdfdfd; 
      }

      .panel-image {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Storybook art is usually full bleed */
        display: block;
        pointer-events: none;
      }

      /* Cover Styling */
      .paper:first-child { 
          box-shadow: 10px 10px 30px rgba(0,0,0,0.3);
      }
      
      /* Hardcover Spine Effect */
      .paper:first-child .front::before {
          content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 16px;
          background: linear-gradient(to right, #5e4b35, #8c6e4e 20%, #a68b6c 40%, #5e4b35 100%);
          border-right: 1px solid rgba(0,0,0,0.2);
          z-index: 25; 
          border-radius: 4px 0 0 4px;
      }

      .comic-btn {
        font-family: 'Fredoka', sans-serif;
        font-weight: 600;
        letter-spacing: 0.5px;
        border: none;
        box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        transition: all 0.2s ease;
        text-transform: uppercase;
        cursor: pointer;
        border-radius: 50px; /* Fully rounded buttons */
        transform: translateZ(30px); 
      }
      .comic-btn:hover:not(:disabled) {
        transform: translateZ(30px) translateY(-2px);
        box-shadow: 0 6px 0 rgba(0,0,0,0.2);
      }
      .comic-btn:active:not(:disabled) {
        transform: translateZ(30px) translateY(2px);
        box-shadow: 0 2px 0 rgba(0,0,0,0.2);
      }
      .comic-btn:disabled {
        filter: grayscale(50%); opacity: 0.7; cursor: wait;
      }

      @media (max-width: 768px) {
        :root { 
             --page-height: min(80vh, 120vw);
             --page-width: calc(var(--page-height) * 0.75);
        }
        
        .comic-scene { 
             perspective: 2000px; 
             align-items: center; 
             height: auto; 
             overflow: visible; 
        }

        .book.opened { transform: translateX(100%); }
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.27.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "recharts": "https://aistudiocdn.com/recharts@^3.3.0",
    "jspdf": "https://aistudiocdn.com/jspdf@^3.0.3"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>